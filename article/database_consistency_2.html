<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="../favicon.png" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		
		<link href="../_app/immutable/assets/0.BduBPsYz.css" rel="stylesheet">
		<link href="../_app/immutable/assets/2.CzhWGdCx.css" rel="stylesheet">
		<link href="../_app/immutable/assets/4.DwwtVzUN.css" rel="stylesheet">
		<link rel="modulepreload" href="../_app/immutable/entry/start.DW8BOcz2.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/DPD_zxZH.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/COc0ozwQ.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/CR_4RHM7.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/BREPnwMB.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/BjM09ad5.js">
		<link rel="modulepreload" href="../_app/immutable/entry/app._zqVhtIp.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/1-kU2YTO.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/Cew64nlL.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/CYQQZ9Kc.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/dbPvbsOE.js">
		<link rel="modulepreload" href="../_app/immutable/nodes/0.DYpUD__7.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/C5SEx9ip.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/C-QlV_CF.js">
		<link rel="modulepreload" href="../_app/immutable/nodes/2.D4f1p83O.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/3ot0CaDB.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/DpQ1lCiU.js">
		<link rel="modulepreload" href="../_app/immutable/nodes/4.C-2xViEP.js">
	</head>
	<body data-sveltekit-preload-data="hover">
		<div style="display: contents"><!--[--><!--[--><!----><div class="app svelte-1t5f27d"><header class="svelte-1wpzjs"><div class="title svelte-1wpzjs">Blog</div></header><!----> <main class="svelte-1t5f27d"><!--[--><!----><div class="article-layout svelte-10kcmdg"><aside class="svelte-10kcmdg"><nav class="svelte-h5mjvk"><h2 class="svelte-h5mjvk"><a href="../article" class="nav-heading-link">文章列表</a></h2> <!--[--><section><button class="category-toggle">Software</button> <!--[!--><!--]--></section><!--]--></nav><!----></aside> <main class="svelte-10kcmdg"><!----><!----><!--[--><article class="prose mx-auto"><div class="article-header svelte-1l2p5et"><h1 class="svelte-1l2p5et">Database Consistency 2</h1> <p class="svelte-1l2p5et">2025-07-28</p></div> <section class="article-body svelte-1l2p5et"><!----><h6>維持多台 Server 資料唯一性的幾種選擇，<a href="https://ithelp.ithome.com.tw/articles/10217086" rel="nofollow">建議閱讀這裡</a></h6> <hr/> <p>實作時不同伺服器中的時間戳不可當作最新資料的判斷依據</p> <br/> <h3>Vector Clock</h3> <p>背景設定有 3 台 replica：R1、R2、R3，每個伺服器都有一個 Vector Clock (DB自己處理+1)來追蹤</p> <br/> <p>Client 讀資料會拿到的格式</p> <pre class="language-text"><!----><code class="language-text">value = 100
version = &#123; R1: 1, R2: 1, R3: 0 &#125;</code><!----></pre> <p>Client 寫入資料</p> <pre class="language-text"><!----><code class="language-text">&#123;
  value: 99,
  old_version: &#123; R1: 1, R2: 1, R3: 0 &#125;
&#125;</code><!----></pre> <p>若是 R1 收到資料後 → 它把自己的版本數加 1</p> <pre class="language-text"><!----><code class="language-text">&#123; R1: 2, R2: 1, R3: 0 &#125;</code><!----></pre> <p>R2 收到資料後 → 也是一樣，把自己的欄位 R2 +1</p> <pre class="language-text"><!----><code class="language-text">&#123; R1: 1, R2: 2, R3: 0 &#125;</code><!----></pre> <p>之後的取就拿數字最大的版本當作最新來源</p><!----></section></article><!--]--><!----><!----></main></div><!----><!--]--><!----></main></div><!----><!--]--> <!--[!--><!--]--><!--]-->
			
			<script>
				{
					__sveltekit_kr1hp1 = {
						base: new URL("..", location).pathname.slice(0, -1),
						assets: "/svelte-blog"
					};

					const element = document.currentScript.parentElement;

					Promise.all([
						import("../_app/immutable/entry/start.DW8BOcz2.js"),
						import("../_app/immutable/entry/app._zqVhtIp.js")
					]).then(([kit, app]) => {
						kit.start(app, element, {
							node_ids: [0, 2, 4],
							data: [null,null,null],
							form: null,
							error: null
						});
					});
				}
			</script>
		</div>
	</body>
</html>
